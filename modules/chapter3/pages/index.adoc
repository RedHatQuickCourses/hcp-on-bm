= Setup the Hub/ACM Cluster

1. Update `/etc/resolv.conf` to set the helper vm as the primary DNS server. Keep the AWS dns server as a secondary option.
+
[source,subs="verbatim,quotes"]
--
# vi /etc/resolv.conf
nameserver 192.168.122.21
nameserver 10.0.0.2
--
+
WARNING: That change is NOT persistent, it's lost if you stop and restart you demo env. :-(

2. Run the ansible playbook to set up the hub cluster and ACM.
+
[source,subs="verbatim,quotes"]
--
# yum install tmux
# ansible-playbook -i inventory/hosts setup_hub_cluster.yaml --ask-vault-pass
--
+
WARNING: My SSH session was terminated (by inactivity?) during execution of the playbook. I don't know if it finished or not. I had to destroy and undefine hub_bootstrap to retry. Keep alive would have helped.
+
WARNING: Tmux was NOT installed in previous steps. It's useful to work around SSH disconnection, but you need to know how to attach to previous tmux sessions.
+
[ 42min "real" time on the second attempt, which finished OK (no failed tasks) ]

3. Copy the kubeconfig and export it and validate the hub cluster is healthy.
+
[source,subs="verbatim,quotes"]
--
# cp /var/lib/libvirt/images/hub_install/auth/kubeconfig .
# export KUBECONFIG=kubeconfig
# oc get co
--

4. Get the console URL.
+
[source,subs="verbatim,quotes"]
--
$ oc get route -A | grep console
--
+
Alternatively [faster!]:
+
[source,subs="verbatim,quotes"]
--
$ oc whoami --show-console
--
+
[ Responses from the Kube API seems to be very slow, on cli and web console]

5. Get the kubeadmin password
+
[source,subs="verbatim,quotes"]
--
$ cat /var/lib/libvirt/images/hub_install/auth/kubeadmin-password
--

6. On the VNC console Launch a web browser and login to the OpenShift console using the kubeadmin user and password.

7. Validate that MetalLB, LVM Storage, and ACM operators are installed and configured.
+
image::s4-fig-1.jpg[]

8. Within the MetalLB operator validate that MetalLB, L2Advertisement and IPAddressPool resources are created.
+
[ ALL good so far... stopped all VMs and the AWS env. Let's see if tomorrow everything restarts fine, or if I'll have to start over. ]
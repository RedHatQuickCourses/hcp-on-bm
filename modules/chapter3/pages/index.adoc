= Prepare the BareMetal Node

* Familiarize yourself with the HCP on BM architecture.
+
image::s3-fig-1.png[]

* Once the instance is up and running, ssh to the node using the private key downloaded earlier. 
+
image::s3-fig-2.jpg[]

* Public IP of the instance can be obtained from the AWS console after clicking on the instance.
+
[source,subs="verbatim,quotes"]
--
ssh -i <path to the private key>  ec2-user@<public ip>
--

* Install Ansible Core and other supporting packages.
+
[source,subs="verbatim,quotes"]
--
sudo -i
yum install ansible-core -y
ansible-galaxy collection install community.libvirt
ansible-galaxy collection install community.crypto
--

* Download latest rhel-9.5-x86_64-kvm.qcow2 from access.redhat.com/downloads and copy to the baremetal node.

* Clone the git repository and move the RHEL Image to the correct directory.
+
[source,subs="verbatim,quotes"]
--
git clone https://github.com/v2pkthakur/hcp-on-bm.git
cp rhel-9.5-x86_64-kvm.qcow2 hcp-on-bm/roles/setup-bm-host/files/
--

* Explore the inventory and variables and update where required.
For example, if you got a newer version of RHEL9 Qcow instead of RHEL9.5, please update rhel9_kvm_image.
+
[source,subs="verbatim,quotes"]
--
vim vars.yaml
...
rhel9_kvm_image: rhel-9.6-x86_64-kvm.qcow2
... 
--

* Setup Graphical user interface and VNC access.
+
[source,subs="verbatim,quotes"]
--
yum groupinstall "Server with GUI"
useradd vncuser
su - vncuser
vpcpasswd   # set password
Would you like to enter a view-only password (y/n)? n
exit
--

* Connect to the public ip of the baremetal node on port 5999 using vncviewer to get GUI. This will be required to access the Openshift Console later.

* Login to console.redhat.com and get Org Id which can be obtained by clicking your name on top right.
+
image::s3-fig-3.jpg[]

* Create an activation key from the console by following the link and note down the name of the activation key. https://console.redhat.com/insights/connector/activation-keys
+
Use the details from the screenshot to fill the activation key details. Make sure that you name it appropriately.
+
image::s3-fig-4.jpg[]

* From the Console, copy/download and save the pull secret by visiting https://console.redhat.com/openshift/install/pull-secret
+
Keep the pull secret available for later use.
+
image::s3-fig-5.jpg[]

* Configure ansible-vault to store Org ID, activation keys and PullSecret.
+
[source,subs="verbatim,quotes"]
--
ansible-vault create vault.yaml
New Vault password:
Confirm New Vault password:
org_id: XXXX
activation_key: YYYYY
pull_secret: 'ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ'
--

* Set up the Baremetal Host by running the ansible playbook.
+
[source,subs="verbatim,quotes"]
--
ansible-playbook -i inventory/hosts setup_bm_host.yaml --ask-vault-pass
--
